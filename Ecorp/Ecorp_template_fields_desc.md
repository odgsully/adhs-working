# Ecorp Complete Template - Field Descriptions

This document describes all **93 columns (A-CO)** in the Ecorp Complete output file and explains in plain English exactly where each field's data comes from.

**File Pattern**: `M.YY_Ecorp_Complete_{timestamp}.xlsx`

---

## Column Summary by Section

| Section | Columns | Count | Description |
|---------|---------|-------|-------------|
| Upload Data | A-C | 3 | Copied from MCAO_Complete |
| Record Index | D | 1 | Sequential grouping by individuals |
| Owner Classification | E | 1 | Classified from owner name |
| ACC Entity Info | F-P | 11 | Scraped from ACC search results |
| Statutory Agents | Q-AB | 12 | Parsed from ACC agent section |
| Managers | AC-AV | 20 | Parsed from ACC principal table |
| Manager/Members | AW-BP | 20 | Parsed from ACC principal table |
| Members | BQ-CJ | 20 | Parsed from ACC principal table |
| Individual Names | CK-CN | 4 | Parsed from owner name string |
| Entity URL | CO | 1 | Captured from ACC page link |

**Total: 93 columns**

---

## Upload Data Columns (A-C)

These three columns come directly from the MCAO_Complete file without any transformation.

### Column A: FULL_ADDRESS

**Where it comes from**: Copied directly from Column A of the MCAO_Complete file.

**What it contains**: The complete street address of the property, typically including street number, street name, city, state, and ZIP code.

**Example**: `123 MAIN ST, PHOENIX, AZ 85001`

---

### Column B: COUNTY

**Where it comes from**: Copied directly from Column B of the MCAO_Complete file.

**What it contains**: The county where the property is located. For this pipeline, this is always MARICOPA since only Maricopa County properties go through MCAO enrichment.

**Example**: `MARICOPA`

---

### Column C: Owner_Ownership

**Where it comes from**: Copied directly from Column E of the MCAO_Complete file (the "Owner_Ownership" field from property records).

**What it contains**: The raw owner name as recorded in county property records. This could be a business name (like "SMITH PROPERTIES LLC") or individual names (like "JOHNSON MICHAEL/SARAH").

**Example**: `ACME INVESTMENTS LLC` or `WILLIAMS ROBERT J/MARY A TR`

---

## Record Index Column (D)

### Column D: ECORP_INDEX_#

**Where it comes from**: Generated by the system using a two-step process:

1. **Initial Assignment**: Each record gets a simple sequential number (1, 2, 3, 4...) based on row order.

2. **Grouping by Individuals**: After all ACC lookups are complete, the system analyzes the people associated with each record (managers, members, statutory agents, individual names). Records that share 85% or more of the same people get assigned the same index number.

**What it contains**: A number that identifies which "family" of related entities a record belongs to. Records with the same ECORP_INDEX_# are likely controlled by the same people.

**Why this matters**: This helps identify when different LLCs or properties are actually controlled by the same individuals, useful for consolidating outreach and understanding corporate structures.

**Example**: If records 1, 3, and 7 all have the same managers (John Smith and Jane Doe), they would all get ECORP_INDEX_# = 1.

---

## Owner Classification Column (E)

### Column E: OWNER_TYPE

**Where it comes from**: Generated by analyzing the Owner_Ownership text (Column C) through the `classify_owner_type()` function.

**How it works**: The system scans the owner name for business-related keywords. If it finds any of these 74+ keywords, it marks the record as "BUSINESS":

- **Corporate indicators**: LLC, CORP, INC, LTD, LP, PARTNERSHIP
- **Trust indicators**: TRUST, TRUSTEE, TR
- **Organization indicators**: SCHOOL, CHURCH, FOUNDATION, ASSOCIATION
- **Business descriptors**: PROPERTIES, HOLDINGS, INVESTMENTS, VENTURES, GROUP
- **Healthcare terms**: MEDICAL, HEALTH, CARE, HOSPICE, CLINIC
- **Government terms**: STATE OF, CITY OF, COUNTY OF, FEDERAL

If none of these keywords are found and the name looks like a simple personal name (2-4 words), it marks the record as "INDIVIDUAL".

**What it contains**: Either `BUSINESS` or `INDIVIDUAL`

**Why this matters**:
- **BUSINESS** records trigger a web lookup on the Arizona Corporation Commission website
- **INDIVIDUAL** records skip the ACC lookup (since people aren't registered as corporations) and instead parse the name into individual names

---

## ACC Entity Information Columns (F-P)

These 11 columns are populated by searching the Arizona Corporation Commission website (ecorp.azcc.gov) for the owner name. **Only BUSINESS owner types get this lookup; INDIVIDUAL types have these fields left blank.**

### Column F: ECORP_SEARCH_NAME

**Where it comes from**: Copied from the Owner_Ownership value (Column C).

**What it contains**: The exact text that was used to search the ACC website.

**Example**: `SMITH PROPERTIES LLC`

---

### Column G: ECORP_TYPE

**Where it comes from**: Generated by analyzing the Search Name through the `classify_name_type()` function.

**What it contains**: Either `Entity` or `Individual(s)` - indicates how the system classified the owner name before lookup.

**Example**: `Entity`

---

### Column H: ECORP_NAME_S

**Where it comes from**: Scraped from the ACC search results table. When you search for a company on ecorp.azcc.gov, it shows a table of matching results - this is the entity name from the first matching result.

**What it contains**: The official registered name of the entity as it appears in ACC records. This may differ slightly from the Owner_Ownership name (e.g., punctuation differences, "LLC" vs "L.L.C.").

**Example**: `SMITH PROPERTIES, LLC`

**When it's blank**: If the ACC search returns no results, or if the owner type is INDIVIDUAL.

---

### Column I: ECORP_ENTITY_ID_S

**Where it comes from**: Scraped from the ACC search results table - specifically the "File Number" column.

**What it contains**: The unique Arizona Corporation Commission file number that identifies this entity. This is the official state registration ID.

**Example**: `L12345678`

**When it's blank**: No ACC results found, or INDIVIDUAL owner type.

---

### Column J: ECORP_ENTITY_TYPE

**Where it comes from**: Scraped from the ACC entity detail page. After clicking on a search result, the system navigates to the detail page and looks for the "Entity Type:" field.

**What it contains**: The legal structure of the business as registered with the state.

**Example**: `L.L.C. - Domestic` or `Corporation - Domestic`

**When it's blank**: No ACC results found, or INDIVIDUAL owner type.

---

### Column K: ECORP_STATUS

**Where it comes from**: Scraped from the ACC entity detail page, specifically the "Entity Status:" field.

**What it contains**: The current registration status of the entity with the state.

**Example**: `Good Standing`, `Active`, `Dissolved`, `Revoked`

**When it's blank**: No ACC results found, or INDIVIDUAL owner type.

---

### Column L: ECORP_FORMATION_DATE

**Where it comes from**: Scraped from the ACC entity detail page, specifically the "Formation Date:" field.

**What it contains**: The date when the entity was originally formed/registered with the Arizona Corporation Commission.

**Example**: `01/15/2020`

**When it's blank**: No ACC results found, or INDIVIDUAL owner type.

---

### Column M: ECORP_BUSINESS_TYPE

**Where it comes from**: Scraped from the ACC entity detail page, specifically the "Business Type:" field.

**What it contains**: Whether the entity is domestic (formed in Arizona) or foreign (formed in another state but registered to do business in Arizona).

**Example**: `Domestic` or `Foreign`

**When it's blank**: No ACC results found, or INDIVIDUAL owner type.

---

### Column N: ECORP_STATE

**Where it comes from**: Scraped from the ACC entity detail page, specifically the "Domicile State:" field.

**What it contains**: The state where the entity was originally formed. For domestic entities, this is Arizona. For foreign entities, this shows their home state.

**Example**: `Arizona`, `Delaware`, `Nevada`

**When it's blank**: No ACC results found, or INDIVIDUAL owner type.

---

### Column O: ECORP_COUNTY

**Where it comes from**: Scraped from the ACC entity detail page, specifically the "County:" field under entity information.

**What it contains**: The Arizona county listed in the entity's registration (often the county of the principal office or statutory agent). **Note**: This is the entity's registered county, which may differ from the property county in Column B.

**Example**: `MARICOPA`, `PIMA`

**When it's blank**: No ACC results found, or INDIVIDUAL owner type.

---

### Column P: ECORP_COMMENTS

**Where it comes from**: Generated by the system when errors occur during ACC lookup.

**What it contains**: Error messages or notes about lookup problems. This field is blank for successful lookups.

**Example**: `Lookup error: timeout`, `Lookup error: element not found`

**When it's blank**: Lookup was successful (no errors), or INDIVIDUAL owner type.

---

## Statutory Agent Columns (Q-AB)

These 12 columns contain information about the entity's statutory agent(s) - the person or company designated to receive legal notices on behalf of the entity. Up to 3 statutory agents are captured.

**Where it comes from**: Parsed from the "Statutory Agent Information" section on the ACC entity detail page using regex pattern matching.

**For each of the 3 possible agents:**

### Columns Q-T: StatutoryAgent1_[Name/Address/Phone/Mail]

| Column | Field | Description |
|--------|-------|-------------|
| Q | StatutoryAgent1_Name | The name of the first statutory agent |
| R | StatutoryAgent1_Address | The address of the first statutory agent |
| S | StatutoryAgent1_Phone | Phone number (currently not extracted, reserved for future) |
| T | StatutoryAgent1_Mail | Email address (currently not extracted, reserved for future) |

### Columns U-X: StatutoryAgent2_[Name/Address/Phone/Mail]

Same structure as Agent 1, for the second statutory agent if present.

### Columns Y-AB: StatutoryAgent3_[Name/Address/Phone/Mail]

Same structure as Agent 1, for the third statutory agent if present.

**Example**:
- StatutoryAgent1_Name: `REGISTERED AGENTS INC`
- StatutoryAgent1_Address: `1234 N CENTRAL AVE STE 500 PHOENIX AZ 85004`

**When blank**: No ACC results found, no statutory agent listed, or INDIVIDUAL owner type.

---

## Manager Columns (AC-AV)

These 20 columns contain information about the entity's managers. Up to 5 managers are captured.

**Where it comes from**: Parsed from the "Principal Information" table on the ACC entity detail page (HTML table with id `grid_principalList`). The system looks for rows where the Title column contains "MANAGER" but NOT "MEMBER".

**For each of the 5 possible managers:**

### Columns AC-AF: Manager1_[Name/Address/Phone/Mail]

| Column | Field | Description |
|--------|-------|-------------|
| AC | Manager1_Name | The name of the first manager |
| AD | Manager1_Address | The address of the first manager |
| AE | Manager1_Phone | Phone number if present in additional table columns |
| AF | Manager1_Mail | Email if present (identified by @ symbol) |

### Columns AG-AJ: Manager2_[Name/Address/Phone/Mail]
### Columns AK-AN: Manager3_[Name/Address/Phone/Mail]
### Columns AO-AR: Manager4_[Name/Address/Phone/Mail]
### Columns AS-AV: Manager5_[Name/Address/Phone/Mail]

Same structure as Manager 1.

**Example**:
- Manager1_Name: `JOHN D SMITH`
- Manager1_Address: `456 E CAMELBACK RD PHOENIX AZ 85016`

**When blank**: No ACC results found, no managers listed in principal table, or INDIVIDUAL owner type.

---

## Manager/Member Columns (AW-BP)

These 20 columns contain information about principals who hold BOTH manager AND member roles. Up to 5 are captured.

**Where it comes from**: Parsed from the same "Principal Information" table. The system looks for rows where the Title column contains BOTH "MANAGER" AND "MEMBER" (e.g., "MANAGER/MEMBER" or "MANAGING MEMBER").

**For each of the 5 possible manager/members:**

### Columns AW-AZ: Manager/Member1_[Name/Address/Phone/Mail]

| Column | Field | Description |
|--------|-------|-------------|
| AW | Manager/Member1_Name | The name |
| AX | Manager/Member1_Address | The address |
| AY | Manager/Member1_Phone | Phone if available |
| AZ | Manager/Member1_Mail | Email if available |

### Columns BA-BD: Manager/Member2_[Name/Address/Phone/Mail]
### Columns BE-BH: Manager/Member3_[Name/Address/Phone/Mail]
### Columns BI-BL: Manager/Member4_[Name/Address/Phone/Mail]
### Columns BM-BP: Manager/Member5_[Name/Address/Phone/Mail]

Same structure as Manager/Member 1.

**When blank**: No ACC results found, no manager/members listed, or INDIVIDUAL owner type.

---

## Member Columns (BQ-CJ)

These 20 columns contain information about the entity's members (ownership interest holders who are not managers). Up to 5 members are captured.

**Where it comes from**: Parsed from the "Principal Information" table. The system looks for rows where the Title column contains "MEMBER" but NOT "MANAGER".

**For each of the 5 possible members:**

### Columns BQ-BT: Member1_[Name/Address/Phone/Mail]

| Column | Field | Description |
|--------|-------|-------------|
| BQ | Member1_Name | The name of the first member |
| BR | Member1_Address | The address |
| BS | Member1_Phone | Phone if available |
| BT | Member1_Mail | Email if available |

### Columns BU-BX: Member2_[Name/Address/Phone/Mail]
### Columns BY-CB: Member3_[Name/Address/Phone/Mail]
### Columns CC-CF: Member4_[Name/Address/Phone/Mail]
### Columns CG-CJ: Member5_[Name/Address/Phone/Mail]

Same structure as Member 1.

**When blank**: No ACC results found, no members listed, or INDIVIDUAL owner type.

---

## Individual Name Columns (CK-CN)

These 4 columns contain parsed individual names for INDIVIDUAL owner types (non-business owners).

**Where it comes from**: Generated by the `parse_individual_names()` function which analyzes the Owner_Ownership text and reformats it.

**How it works**: The function handles various name formats found in property records:

1. **Names with shared last name**: `MCCORMICK TIMOTHY/ROBIN` becomes:
   - IndividualName1: `TIMOTHY MCCORMICK`
   - IndividualName2: `ROBIN MCCORMICK`

2. **Names with different last names**: `SOTO JEREMY/SIPES CAROLYN` becomes:
   - IndividualName1: `JEREMY SOTO`
   - IndividualName2: `CAROLYN SIPES`

3. **Single name with middle initial**: `GREEN JEROME V` becomes:
   - IndividualName1: `JEROME V GREEN`

4. **Names with trust indicators**: `BARATTI JAMES J/DEBORAH F TR` - the "TR" is stripped, resulting in:
   - IndividualName1: `JAMES J BARATTI`
   - IndividualName2: `DEBORAH F BARATTI`

**Suffixes automatically removed**: TR, TRUST, TRUSTEE, ET AL, JT TEN, JTRS, JT, EST, ESTATE

**Name reordering**: The function assumes property records use "LASTNAME FIRSTNAME MIDDLE" format and reorders to "FIRSTNAME MIDDLE LASTNAME" for better readability.

### Columns CK-CN

| Column | Field | Description |
|--------|-------|-------------|
| CK | IndividualName1 | First parsed individual name |
| CL | IndividualName2 | Second parsed individual name |
| CM | IndividualName3 | Third parsed individual name |
| CN | IndividualName4 | Fourth parsed individual name |

**When blank**:
- BUSINESS owner type (ACC lookup done instead)
- Fewer than 4 individuals in the owner name
- Owner_Ownership is blank

---

## Entity URL Column (CO)

### Column CO: ECORP_URL

**Where it comes from**: Captured when the system opens the ACC entity detail page. The URL is grabbed from the `href` attribute of the entity link in the search results.

**What it contains**: A direct link to the Arizona Corporation Commission entity detail page where you can view all registration information, historical filings, and annual reports.

**Example**: `https://ecorp.azcc.gov/EntitySearch/Details?entityNumber=L12345678`

**Why this is useful**:
- Allows manual verification of scraped data
- Provides access to additional information not scraped (like historical filings)
- Enables due diligence and research
- Can be included in reports for reference

**When blank**: No ACC results found, or INDIVIDUAL owner type.

---

## Population Logic Summary

### For BUSINESS Owner Types

1. **Columns A-C**: Copied from MCAO_Complete
2. **Column D**: Sequential number, then grouped by person overlap
3. **Column E**: Set to "BUSINESS"
4. **Columns F-CO**: Populated via ACC web scraping:
   - Navigate to ecorp.azcc.gov
   - Search for Owner_Ownership name
   - Click first matching result
   - Scrape entity info, statutory agents, principals
   - Capture detail page URL
5. **Columns CK-CN**: Left blank (no individual parsing)

### For INDIVIDUAL Owner Types

1. **Columns A-C**: Copied from MCAO_Complete
2. **Column D**: Sequential number, then grouped by person overlap
3. **Column E**: Set to "INDIVIDUAL"
4. **Columns F-P**: Left blank (no ACC lookup)
5. **Columns Q-CJ**: Left blank (no ACC lookup)
6. **Columns CK-CN**: Populated by parsing Owner_Ownership into individual names
7. **Column CO**: Left blank (no ACC lookup)

### For Blank Owner_Ownership

All ACC fields (F-CO) are left blank. Only columns A-E are populated.

---

## Code Reference

All field population logic is implemented in:

**File**: `src/adhs_etl/ecorp.py`

**Key Functions**:

| Function | Purpose |
|----------|---------|
| `generate_ecorp_complete()` | Main orchestrator - processes Upload file, manages lookups, saves Complete file |
| `classify_owner_type()` | Determines BUSINESS vs INDIVIDUAL for Column E |
| `classify_name_type()` | Determines Entity vs Individual(s) for Column G |
| `search_entities()` | Performs ACC web scraping, populates F-P and Q-CJ and CO |
| `get_statutory_agent_info()` | Extracts statutory agent data using regex patterns |
| `extract_principal_info()` | Parses HTML table to extract managers/members |
| `parse_individual_names()` | Converts owner string to individual names for CK-CN |
| `get_blank_acc_record()` | Returns empty 88-field record structure |
| `assign_grouped_indexes_by_individuals()` | Groups records by person overlap for Column D |
| `extract_individual_names()` | Pulls all person names from a record for grouping |
| `calculate_person_overlap()` | Fuzzy matches name sets to determine similarity |

---

## Usage Example

```python
from src.adhs_etl.ecorp import generate_ecorp_upload, generate_ecorp_complete
from pathlib import Path

# Step 1: Create Upload from MCAO_Complete
month = "1.25"
mcao_file = Path("MCAO/Complete/1.25_MCAO_Complete_01.15.03-45-30.xlsx")
upload_path = generate_ecorp_upload(month, mcao_file)

# Step 2: Enrich Upload â†’ Complete (93 columns)
if upload_path:
    success = generate_ecorp_complete(month, upload_path, headless=True)
    # Output: Ecorp/Complete/1.25_Ecorp_Complete_01.15.03-45-30.xlsx
```

---

## Notes

- Maximum limits: 3 statutory agents, 5 managers, 5 manager/members, 5 members, 4 individual names
- Phone and Mail fields for statutory agents are currently reserved but not extracted
- Column order is critical - must maintain exact A-CO sequence
- ECORP_INDEX_# uses 85% person overlap threshold for grouping
- In-memory caching prevents duplicate ACC lookups for same owner name
- Processing rate: ~4 seconds per BUSINESS record, instant for INDIVIDUAL
